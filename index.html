<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×©×¨×•×ª×™ ×¨×›×‘ ×¤× ×¡×™× ×•××¨××•×ª - ×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Heebo', sans-serif;
        }
        
        body {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #c31432 0%, #f15a24 35%, #ff6b35 65%, #ff8c42 100%);
            animation: gradientShift 8s ease infinite;
            background-size: 200% 200%;
        }
        
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #ff6b35 0%, #f15a24 100%);
            box-shadow: 0 10px 30px rgba(241, 90, 36, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(241, 90, 36, 0.5);
        }
        
        .btn-primary:active {
            transform: translateY(0);
        }
        
        .input-field {
            transition: all 0.3s ease;
            border: 2px solid #e5e7eb;
        }
        
        .input-field:focus {
            border-color: #ff6b35;
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
            transform: translateY(-1px);
        }
        
        .pulse-icon {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.8;
                transform: scale(1.05);
            }
        }
        
        .floating {
            animation: floating 3s ease-in-out infinite;
        }
        
        @keyframes floating {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-10px);
            }
        }
        
        .progress-bar {
            height: 4px;
            background: linear-gradient(to right, #ff6b35, #f15a24);
            transition: width 0.3s ease;
        }
        
        .checkmark-icon {
            stroke-dasharray: 100;
            stroke-dashoffset: 100;
            animation: drawCheck 0.6s ease-out forwards;
        }
        
        @keyframes drawCheck {
            to {
                stroke-dashoffset: 0;
            }
        }
        
        .feature-card {
            transition: all 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
        }
        
        .image-preview-item {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .image-preview-item:hover {
            transform: scale(1.05);
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #ff6b35;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23ff6b35'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: left 1rem center;
            background-size: 1.5em 1.5em;
            padding-left: 3rem;
        }
        
        .chat-bubble {
            max-width: 80%;
            word-wrap: break-word;
        }
        
        .chat-bubble-ofer {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
        }
        
        .chat-bubble-customer {
            background: #f3f4f6;
            color: #1f2937;
        }
        
        .chat-container {
            max-height: 500px;
            overflow-y: auto;
        }
        
        .chat-container::-webkit-scrollbar {
            width: 8px;
        }
        
        .chat-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .chat-container::-webkit-scrollbar-thumb {
            background: #ff6b35;
            border-radius: 10px;
        }
        
        .chat-container::-webkit-scrollbar-thumb:hover {
            background: #f15a24;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div id="app"></div>

    <script>
        // Admin credentials
        const ADMIN_USERNAME = 'ofer';
        const ADMIN_PASSWORD = 'panasim2024';
        
        // Check if we're on admin page
        const hasSecretLink = window.location.hash === '#admin-secret-ofer-2024';
        const isAuthenticated = sessionStorage.getItem('adminAuth') === 'true';
        
        // Global state
        let currentView = (hasSecretLink || isAuthenticated) ? 'admin' : 'customer';
        let requests = JSON.parse(localStorage.getItem('serviceRequests') || '[]');
        let selectedRequest = null;
        let formData = { 
            carPart: '', 
            carManufacturer: '', 
            carModel: '', 
            year: '', 
            description: '', 
            name: '', 
            phone: '', 
            email: '',
            urgency: '×¨×’×™×œ'
        };
        let images = [];
        let responseText = '';
        let customerReplyText = '';
        let showSuccess = false;
        let showStatusCheck = false;
        let statusPhone = '';
        let statusResult = null;
        let formProgress = 0;
        let isSubmitting = false;

        // Calculate form progress
        function calculateProgress() {
            const fields = ['carPart', 'carManufacturer', 'carModel', 'name', 'phone'];
            const filled = fields.filter(f => formData[f]).length;
            formProgress = (filled / fields.length) * 100;
        }

        // Render functions
        function render() {
            const app = document.getElementById('app');
            if (currentView === 'customer') {
                app.innerHTML = renderCustomerView();
            } else {
                app.innerHTML = renderAdminView();
            }
            attachEventListeners();
        }

        function renderCustomerView() {
            calculateProgress();
            
            return `
                <div class="min-h-screen p-4 pb-20">
                    <div class="max-w-2xl mx-auto">
                        <!-- Progress Bar -->
                        ${formProgress > 0 && !showSuccess ? `
                        <div class="fixed top-0 left-0 right-0 z-50 bg-white shadow-md">
                            <div class="progress-bar" style="width: ${formProgress}%"></div>
                        </div>
                        ` : ''}

                        <!-- Hero Section -->
                        <div class="text-center text-white mb-8 py-12 fade-in">
                            <div class="inline-block bg-white/20 rounded-full p-8 mb-6 floating pulse-icon backdrop-blur-sm">
                                <svg class="w-20 h-20 text-white" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.21.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99zM6.5 16c-.83 0-1.5-.67-1.5-1.5S5.67 13 6.5 13s1.5.67 1.5 1.5S7.33 16 6.5 16zm11 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zM5 11l1.5-4.5h11L19 11H5z"/>
                                </svg>
                            </div>
                            <h1 class="text-5xl font-bold mb-3 leading-tight">×—×œ×§×™ ×—×™×œ×•×£ ××©×•××©×™×</h1>
                            <h2 class="text-4xl font-bold mb-6 leading-tight">×‘××™×›×•×ª ××¢×•×œ×” ğŸ†</h2>
                            <p class="text-xl text-white/95 mb-4 max-w-xl mx-auto leading-relaxed">
                                ××ª××—×™× ×‘××™×ª×•×¨ ×•×¡×¤×§×” ×©×œ ×—×œ×§×™ ×¨×›×‘ ××©×•××©×™× ××›×œ ×”×¡×•×’×™×
                            </p>
                            <p class="text-lg text-white/90 font-medium">×¤× ×¡×™× â€¢ ××¨××•×ª â€¢ ×’×¨×™×œ×™× â€¢ ×“×œ×ª×•×ª â€¢ ×•×¢×•×“</p>
                            
                            <div class="flex flex-wrap justify-center gap-6 mt-8 text-sm font-medium">
                                ${[
                                    { icon: 'âœ“', text: '××œ××™ ×¢× ×§' },
                                    { icon: 'âœ“', text: '××—×™×¨×™× ×”×•×’× ×™×' },
                                    { icon: 'âœ“', text: '×©×™×¨×•×ª ××”×™×¨' }
                                ].map((item, idx) => `
                                    <div class="flex items-center gap-2 bg-white/20 backdrop-blur-sm px-5 py-3 rounded-full slide-in" style="animation-delay: ${idx * 0.1}s">
                                        <div class="w-6 h-6 bg-white text-orange-500 rounded-full flex items-center justify-center font-bold">
                                            ${item.icon}
                                        </div>
                                        <span class="text-white font-semibold">${item.text}</span>
                                    </div>
                                `).join('')}
                            </div>

                            <div class="mt-8 space-y-3">
                                <button
                                    onclick="toggleStatusCheck()"
                                    class="bg-white/20 backdrop-blur-sm text-white px-8 py-4 rounded-2xl hover:bg-white/30 transition-all font-bold border-2 border-white/40 inline-flex items-center gap-3 shadow-lg hover:shadow-xl transform hover:-translate-y-1"
                                >
                                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"/>
                                    </svg>
                                    ×‘×“×•×§ ×¡×˜×˜×•×¡ ×‘×§×©×”
                                </button>
                                
                                <div class="text-white/80 text-sm">
                                    <p>ğŸ“ ××©×” ×‘×§×¨ 31, ×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ</p>
                                    <a href="tel:0501234567" class="inline-block mt-2 hover:text-white transition">
                                        ğŸ“ 050-123-4567
                                    </a>
                                </div>
                            </div>
                        </div>

                        ${showStatusCheck ? renderStatusCheck() : ''}

                        ${showSuccess ? `
                        <div class="glass-card rounded-3xl p-8 mb-8 shadow-2xl fade-in">
                            <div class="flex flex-col items-center text-center">
                                <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mb-4">
                                    <svg class="w-12 h-12 text-green-600 checkmark-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
                                    </svg>
                                </div>
                                <h3 class="text-2xl font-bold text-green-800 mb-2">×”×‘×§×©×” × ×©×œ×—×” ×‘×”×¦×œ×—×”! ğŸ‰</h3>
                                <p class="text-green-700 text-lg">× ×—×–×•×¨ ××œ×™×š ×ª×•×š 24 ×©×¢×•×ª</p>
                                <p class="text-green-600 text-sm mt-3">××¡×¤×¨ ×‘×§×©×”: #${requests[requests.length - 1]?.id || ''}</p>
                            </div>
                        </div>
                        ` : ''}

                        <!-- Form Card -->
                        ${!showStatusCheck && !showSuccess ? `
                        <div class="glass-card rounded-3xl shadow-2xl p-8 mb-8 fade-in">
                            <div class="flex items-center gap-4 mb-8">
                                <div class="bg-gradient-to-br from-orange-500 to-red-600 rounded-2xl p-4 shadow-lg">
                                    <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.21.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99z"/>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-3xl font-bold text-gray-800">×¤×¨×˜×™ ×”×¨×›×‘ ×•×”×—×œ×§</h3>
                                    <p class="text-gray-600 text-sm mt-1">××œ× ××ª ×”×¤×¨×˜×™× ×•× ×—×–×•×¨ ××œ×™×š ×‘×”×§×“×</p>
                                </div>
                            </div>

                            <form id="customerForm" class="space-y-6">
                                <!-- Car Part Dropdown -->
                                <div class="slide-in">
                                    <label class="block text-right text-gray-800 font-bold mb-3 text-lg">
                                        ×¡×•×’ ×”×—×œ×§ ×”××‘×•×§×© *
                                    </label>
                                    <select
                                        id="carPart"
                                        class="input-field w-full p-5 border-2 rounded-2xl text-right focus:outline-none bg-white text-lg font-medium"
                                        required
                                    >
                                        <option value="">×‘×—×¨ ×¡×•×’ ×—×œ×§</option>
                                        <option value="×¤× ×¡ ×§×“××™">×¤× ×¡ ×§×“××™</option>
                                        <option value="×¤× ×¡ ××—×•×¨×™">×¤× ×¡ ××—×•×¨×™</option>
                                        <option value="××¨××” ×¦×“">××¨××” ×¦×“</option>
                                        <option value="×’×¨×™×œ ×§×“××™">×’×¨×™×œ ×§×“××™</option>
                                        <option value="×¤×’×•×© ×§×“××™">×¤×’×•×© ×§×“××™</option>
                                        <option value="×¤×’×•×© ××—×•×¨×™">×¤×’×•×© ××—×•×¨×™</option>
                                        <option value="×“×œ×ª">×“×œ×ª</option>
                                        <option value="××›×¡×” ×× ×•×¢">××›×¡×” ×× ×•×¢</option>
                                        <option value="××›×¡×” ×ª× ××˜×¢×Ÿ">××›×¡×” ×ª× ××˜×¢×Ÿ</option>
                                        <option value="×¤× ×“×¨">×¤× ×“×¨</option>
                                        <option value="××—×¨">××—×¨</option>
                                    </select>
                                </div>

                                <!-- Car Details -->
                                <div class="slide-in" style="animation-delay: 0.1s">
                                    <label class="block text-right text-gray-800 font-bold mb-3 text-lg">
                                        ×™×¦×¨×Ÿ ×”×¨×›×‘ *
                                    </label>
                                    <input
                                        type="text"
                                        id="carManufacturer"
                                        value="${formData.carManufacturer}"
                                        class="input-field w-full p-5 border-2 rounded-2xl text-right focus:outline-none text-lg"
                                        placeholder="×œ×“×•×’××”: ×˜×•×™×•×˜×”, ×××–×“×”, ×™×•× ×“××™"
                                        required
                                    />
                                </div>

                                <div class="slide-in" style="animation-delay: 0.2s">
                                    <label class="block text-right text-gray-800 font-bold mb-3 text-lg">
                                        ×“×’× ×”×¨×›×‘ *
                                    </label>
                                    <input
                                        type="text"
                                        id="carModel"
                                        value="${formData.carModel}"
                                        class="input-field w-full p-5 border-2 rounded-2xl text-right focus:outline-none text-lg"
                                        placeholder="×œ×“×•×’××”: ×§×•×¨×•×œ×”, ×¡×™×•×™×§, i30"
                                        required
                                    />
                                </div>

                                <div class="slide-in" style="animation-delay: 0.3s">
                                    <label class="block text-right text-gray-800 font-bold mb-3 text-lg">
                                        ×©× ×ª ×™×™×¦×•×¨
                                    </label>
                                    <input
                                        type="text"
                                        id="year"
                                        value="${formData.year}"
                                        class="input-field w-full p-5 border-2 rounded-2xl text-right focus:outline-none text-lg"
                                        placeholder="×œ×“×•×’××”: 2018"
                                    />
                                </div>

                                <div class="slide-in" style="animation-delay: 0.4s">
                                    <label class="block text-right text-gray-800 font-bold mb-3 text-lg">
                                        ×¤×¨×˜×™× × ×•×¡×¤×™×
                                    </label>
                                    <textarea
                                        id="description"
                                        class="input-field w-full p-5 border-2 rounded-2xl text-right focus:outline-none text-lg resize-none"
                                        rows="4"
                                        placeholder="×ª××¨ ××ª ×”×—×œ×§ ×”××‘×•×§×©, ×¦×‘×¢ ×¨×¦×•×™ ×•×›×œ ×¤×¨×˜ ×¨×œ×•×•× ×˜×™ × ×•×¡×£..."
                                    >${formData.description}</textarea>
                                </div>

                                <!-- Urgency Field -->
                                <div class="slide-in" style="animation-delay: 0.45s">
                                    <label class="block text-right text-gray-800 font-bold mb-3 text-lg">
                                        ×¨××ª ×“×—×™×¤×•×ª *
                                    </label>
                                    <select
                                        id="urgency"
                                        class="input-field w-full p-5 border-2 rounded-2xl text-right focus:outline-none bg-white text-lg font-medium"
                                        required
                                    >
                                        <option value="×¨×’×™×œ">×¨×’×™×œ - ×ª×•×š ××¡×¤×¨ ×™××™×</option>
                                        <option value="×“×—×•×£">×“×—×•×£ - ×ª×•×š 24 ×©×¢×•×ª</option>
                                        <option value="×“×—×•×£ ×××•×“">×“×—×•×£ ×××•×“ - ×”×™×•×!</option>
                                    </select>
                                </div>

                                <!-- Image Upload -->
                                <div class="slide-in" style="animation-delay: 0.5s">
                                    <label class="block text-right text-gray-800 font-bold mb-3 text-lg">
                                        ğŸ“¸ ×ª××•× ×” ×©×œ ×”×—×œ×§ (××•×¤×¦×™×•× ×œ×™)
                                    </label>
                                    <div class="bg-gradient-to-br from-orange-50 to-red-50 border-2 border-dashed border-orange-300 rounded-2xl p-8 text-center hover:border-orange-400 transition-all">
                                        <div class="mb-4">
                                            <svg class="w-16 h-16 mx-auto text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                            </svg>
                                        </div>
                                        <p class="text-base text-orange-800 mb-4 font-medium leading-relaxed">
                                            ğŸ’¡ <strong>×˜×™×¤:</strong> ×”×¢×œ××ª ×ª××•× ×” ×ª×¢×–×•×¨ ×œ× ×• ×œ×–×”×•×ª ××ª ×”×—×œ×§ ×”××“×•×™×§<br>
                                            ×•×œ×ª×ª ×œ×š ××¢× ×” ××”×™×¨ ×•××“×•×™×§ ×™×•×ª×¨
                                        </p>
                                        <input
                                            type="file"
                                            multiple
                                            accept="image/*"
                                            id="imageUpload"
                                            class="hidden"
                                        />
                                        <label
                                            for="imageUpload"
                                            class="inline-flex items-center gap-3 btn-primary text-white px-8 py-4 rounded-2xl cursor-pointer font-bold text-lg shadow-lg"
                                        >
                                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                                            </svg>
                                            ×‘×—×¨ ×ª××•× ×•×ª
                                        </label>
                                        <p class="text-xs text-gray-500 mt-3">PNG, JPG â€¢ ×¢×“ 10MB ×œ×ª××•× ×”</p>
                                        ${images.length > 0 ? `<p class="text-base text-orange-600 font-bold mt-3">âœ“ ${images.length} ×ª××•× ×•×ª × ×‘×—×¨×•</p>` : ''}
                                    </div>

                                    ${images.length > 0 ? `
                                    <div class="grid grid-cols-3 gap-4 mt-5" id="imagePreview">
                                        ${images.map((img, idx) => `
                                            <div class="relative image-preview-item rounded-2xl overflow-hidden shadow-lg">
                                                <img src="${img.url}" alt="${img.name}" class="w-full h-32 object-cover" />
                                                <button
                                                    type="button"
                                                    onclick="removeImage(${idx})"
                                                    class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-2 hover:bg-red-600 shadow-xl transform hover:scale-110 transition-all"
                                                >
                                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                                                    </svg>
                                                </button>
                                            </div>
                                        `).join('')}
                                    </div>
                                    ` : ''}
                                </div>

                                <!-- Contact Details Section -->
                                <div class="border-t-2 border-gray-200 pt-8 mt-8 slide-in" style="animation-delay: 0.6s">
                                    <div class="flex items-center gap-4 mb-8">
                                        <div class="bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl p-4 shadow-lg">
                                            <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-6-3a2 2 0 11-4 0 2 2 0 014 0zm-2 4a5 5 0 00-4.546 2.916A5.986 5.986 0 0010 16a5.986 5.986 0 004.546-2.084A5 5 0 0010 11z" clip-rule="evenodd"/>
                                            </svg>
                                        </div>
                                        <div>
                                            <h3 class="text-3xl font-bold text-gray-800">×¤×¨×˜×™ ×™×¦×™×¨×ª ×§×©×¨</h3>
                                            <p class="text-gray-600 text-sm mt-1">×›×š × ×•×›×œ ×œ×—×–×•×¨ ××œ×™×š</p>
                                        </div>
                                    </div>

                                    <div class="space-y-6">
                                        <div>
                                            <label class="block text-right text-gray-800 font-bold mb-3 text-lg">
                                                ×©× ××œ× *
                                            </label>
                                            <input
                                                type="text"
                                                id="name"
                                                value="${formData.name}"
                                                class="input-field w-full p-5 border-2 rounded-2xl text-right focus:outline-none text-lg"
                                                placeholder="××™×š ×§×•×¨××™× ×œ×š?"
                                                required
                                            />
                                        </div>

                                        <div>
                                            <label class="block text-right text-gray-800 font-bold mb-3 text-lg">
                                                ××¡×¤×¨ ×˜×œ×¤×•×Ÿ *
                                            </label>
                                            <div class="relative">
                                                <input
                                                    type="tel"
                                                    id="phone"
                                                    value="${formData.phone}"
                                                    class="input-field w-full p-5 border-2 rounded-2xl text-right focus:outline-none pr-14 text-lg"
                                                    placeholder="050-1234567"
                                                    required
                                                />
                                                <svg class="w-7 h-7 text-gray-400 absolute left-5 top-1/2 transform -translate-y-1/2" fill="currentColor" viewBox="0 0 20 20">
                                                    <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
                                                </svg>
                                            </div>
                                        </div>

                                        <div>
                                            <label class="block text-right text-gray-800 font-bold mb-3 text-lg">
                                                ××™××™×™×œ (××•×¤×¦×™×•× ×œ×™)
                                            </label>
                                            <div class="relative">
                                                <input
                                                    type="email"
                                                    id="email"
                                                    value="${formData.email}"
                                                    class="input-field w-full p-5 border-2 rounded-2xl text-right focus:outline-none pr-14 text-lg"
                                                    placeholder="your@email.com"
                                                />
                                                <svg class="w-7 h-7 text-gray-400 absolute left-5 top-1/2 transform -translate-y-1/2" fill="currentColor" viewBox="0 0 20 20">
                                                    <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
                                                    <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <button
                                    type="submit"
                                    id="submitBtn"
                                    class="btn-primary w-full text-white py-6 rounded-2xl font-bold text-2xl flex items-center justify-center gap-4 mt-8"
                                    ${isSubmitting ? 'disabled' : ''}
                                >
                                    ${isSubmitting ? `
                                        <div class="spinner"></div>
                                        <span>×©×•×œ×—...</span>
                                    ` : `
                                        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"/>
                                        </svg>
                                        <span>×©×œ×— ×‘×§×©×”</span>
                                    `}
                                </button>

                                <p class="text-center text-gray-500 text-sm mt-4">
                                    ğŸ”’ ×”××™×“×¢ ×©×œ×š ×××•×‘×˜×— ×•×œ× ×™×•×¢×‘×¨ ×œ×’×•×¨× ×©×œ×™×©×™
                                </p>
                            </form>
                        </div>
                        ` : ''}

                        <!-- Trust Indicators -->
                        ${!showStatusCheck ? `
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                            ${[
                                { icon: 'âš¡', title: '××¢× ×” ×ª×•×š 24 ×©×¢×•×ª', desc: '× ×—×–×•×¨ ××œ×™×š ×‘××”×™×¨×•×ª' },
                                { icon: 'âœ“', title: '×©×™×¨×•×ª ××§×¦×•×¢×™', desc: '×¦×•×•×ª ×× ×•×¡×” ×•××§×¦×•×¢×™' },
                                { icon: 'ğŸ†', title: '××™×›×•×ª ××•×‘×˜×—×ª', desc: '×—×œ×§×™× ×‘×‘×“×™×§×” ×§×¤×“× ×™×ª' }
                            ].map((item, idx) => `
                                <div class="glass-card rounded-2xl p-6 text-center feature-card slide-in" style="animation-delay: ${idx * 0.1}s">
                                    <div class="text-4xl mb-3">${item.icon}</div>
                                    <h4 class="font-bold text-gray-800 mb-1">${item.title}</h4>
                                    <p class="text-gray-600 text-sm">${item.desc}</p>
                                </div>
                            `).join('')}
                        </div>
                        ` : ''}

                        <!-- Footer -->
                        <div class="text-center text-white text-sm mt-12 pb-8">
                            <p class="font-bold text-lg mb-2">×©×¨×•×ª×™ ×¨×›×‘ ×¤× ×¡×™× ×•××¨××•×ª</p>
                            <p class="mb-1">×¨×—×•×‘ ××©×” ×‘×§×¨ 31, ×¨××©×•×Ÿ ×œ×¦×™×•×Ÿ</p>
                            <a href="tel:0501234567" class="hover:underline">ğŸ“ 050-123-4567</a>
                            <p class="mt-4 text-white/70 text-xs">Â© 2024 ×›×œ ×”×–×›×•×™×•×ª ×©××•×¨×•×ª</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderStatusCheck() {
            return `
                <div class="glass-card rounded-3xl shadow-2xl p-8 mb-8 fade-in">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-3xl font-bold text-gray-800 flex items-center gap-3">
                            <svg class="w-8 h-8 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"/>
                            </svg>
                            ×‘×“×™×§×ª ×¡×˜×˜×•×¡ ×‘×§×©×”
                        </h2>
                        <button
                            onclick="closeStatusCheck()"
                            class="text-gray-400 hover:text-gray-600 text-3xl transform hover:rotate-90 transition-all"
                        >
                            âœ•
                        </button>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-right text-gray-700 font-bold mb-3 text-lg">
                            ×”×–×Ÿ ××ª ××¡×¤×¨ ×”×˜×œ×¤×•×Ÿ ×©×œ×š:
                        </label>
                        <div class="flex gap-3">
                            <input
                                type="tel"
                                id="statusPhone"
                                value="${statusPhone}"
                                class="flex-1 p-5 border-2 border-gray-200 rounded-2xl text-right focus:border-orange-500 focus:outline-none text-lg"
                                placeholder="050-1234567"
                            />
                            <button
                                onclick="checkStatus()"
                                class="btn-primary text-white px-10 py-5 rounded-2xl font-bold text-lg shadow-lg"
                            >
                                ×—×¤×©
                            </button>
                        </div>
                    </div>

                    ${statusResult ? renderStatusResult() : ''}
                </div>
            `;
        }

        function renderStatusResult() {
            if (statusResult === 'not_found') {
                return `
                    <div class="bg-yellow-50 border-2 border-yellow-300 rounded-2xl p-6 text-center fade-in">
                        <div class="text-5xl mb-3">ğŸ”</div>
                        <p class="text-yellow-800 font-bold text-xl mb-2">×œ× × ××¦××” ×‘×§×©×”</p>
                        <p class="text-yellow-700">×•×“× ×©×”×–× ×ª ××ª ××¡×¤×¨ ×”×˜×œ×¤×•×Ÿ ×”× ×›×•×Ÿ</p>
                    </div>
                `;
            }

            const req = statusResult;
            const conversation = req.conversation || [];
            
            return `
                <div class="border-2 border-orange-300 rounded-2xl p-6 bg-orange-50 fade-in">
                    <h3 class="font-bold text-2xl text-orange-900 mb-4 flex items-center gap-2">
                        <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                        </svg>
                        ×¤×¨×˜×™ ×”×‘×§×©×” ×©×œ×š
                    </h3>
                    
                    <div class="bg-white rounded-2xl p-6 mb-4 shadow">
                        <div class="space-y-3 text-base">
                            <p><strong>ğŸ‘¤ ×©×:</strong> ${req.name}</p>
                            <p><strong>ğŸ“ ×˜×œ×¤×•×Ÿ:</strong> ${req.phone}</p>
                            <p><strong>ğŸ”§ ×—×œ×§:</strong> ${req.carPart}</p>
                            <p><strong>ğŸš— ×¨×›×‘:</strong> ${req.carManufacturer} ${req.carModel} ${req.year || ''}</p>
                            <p class="text-gray-500 text-sm">
                                <strong>ğŸ• × ×©×œ×—×”:</strong> ${new Date(req.createdAt).toLocaleString('he-IL')}
                            </p>
                        </div>
                        
                        ${req.description ? `
                        <div class="border-t pt-4 mt-4">
                            <p class="font-bold mb-2">×¤×¨×˜×™× × ×•×¡×¤×™×:</p>
                            <p class="text-gray-700">${req.description}</p>
                        </div>
                        ` : ''}

                        ${req.images.length > 0 ? `
                            <div class="border-t pt-4 mt-4">
                                <p class="font-bold mb-3">×ª××•× ×•×ª (${req.images.length}):</p>
                                <div class="grid grid-cols-3 gap-3">
                                    ${req.images.map(img => `
                                        <img
                                            src="${img.url}"
                                            alt="${img.name}"
                                            class="w-full h-24 object-cover rounded-lg cursor-pointer hover:opacity-80 shadow transition"
                                            onclick="window.open('${img.url}', '_blank')"
                                        />
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                    </div>

                    ${conversation.length > 0 || req.response ? `
                        <div class="bg-white rounded-2xl p-6 mb-4 shadow">
                            <h4 class="font-bold text-xl mb-4 flex items-center gap-2">
                                <svg class="w-6 h-6 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"/>
                                </svg>
                                ×©×™×—×” ×¢× ×¢×•×¤×¨
                            </h4>
                            
                            <div class="chat-container space-y-4 mb-4">
                                ${req.response ? `
                                    <div class="flex justify-start">
                                        <div class="chat-bubble chat-bubble-ofer rounded-2xl p-4 shadow">
                                            <p class="text-sm font-semibold mb-1 opacity-90">×¢×•×¤×¨</p>
                                            <p class="leading-relaxed">${req.response}</p>
                                            <p class="text-xs mt-2 opacity-75">${new Date(req.answeredAt).toLocaleString('he-IL', { hour: '2-digit', minute: '2-digit', day: '2-digit', month: '2-digit' })}</p>
                                        </div>
                                    </div>
                                ` : ''}
                                
                                ${conversation.map(msg => `
                                    <div class="flex ${msg.sender === 'ofer' ? 'justify-start' : 'justify-end'}">
                                        <div class="chat-bubble ${msg.sender === 'ofer' ? 'chat-bubble-ofer' : 'chat-bubble-customer'} rounded-2xl p-4 shadow">
                                            <p class="text-sm font-semibold mb-1 ${msg.sender === 'ofer' ? 'opacity-90' : 'text-gray-600'}">${msg.sender === 'ofer' ? '×¢×•×¤×¨' : '××ª×”'}</p>
                                            <p class="leading-relaxed">${msg.message}</p>
                                            <p class="text-xs mt-2 ${msg.sender === 'ofer' ? 'opacity-75' : 'text-gray-500'}">${new Date(msg.timestamp).toLocaleString('he-IL', { hour: '2-digit', minute: '2-digit', day: '2-digit', month: '2-digit' })}</p>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            
                            ${req.status !== 'pending' ? `
                                <div class="border-t pt-4">
                                    <label class="block text-right font-bold mb-2">×”×©×‘ ×œ×¢×•×¤×¨:</label>
                                    <div class="flex gap-2">
                                        <textarea
                                            id="customerReply"
                                            class="flex-1 p-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none resize-none"
                                            rows="3"
                                            placeholder="×›×ª×•×‘ ××ª ×ª×’×•×‘×ª×š ×›××Ÿ..."
                                        >${customerReplyText}</textarea>
                                    </div>
                                    <button
                                        onclick="sendCustomerReply()"
                                        class="mt-3 bg-blue-600 text-white px-6 py-3 rounded-xl hover:bg-blue-700 transition font-bold flex items-center gap-2"
                                    >
                                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"/>
                                        </svg>
                                        ×©×œ×—
                                    </button>
                                </div>
                            ` : ''}
                        </div>
                    ` : `
                        <div class="bg-yellow-100 border-2 border-yellow-400 rounded-2xl p-6 text-center">
                            <div class="text-5xl mb-3">â³</div>
                            <p class="text-yellow-800 font-bold text-xl mb-2">×”×‘×§×©×” ×××ª×™× ×” ×œ×˜×™×¤×•×œ</p>
                            <p class="text-yellow-700">× ×—×–×•×¨ ××œ×™×š ×‘×”×§×“×!</p>
                        </div>
                    `}
                </div>
            `;
        }

        function renderAdminView() {
            if (selectedRequest) {
                return renderSingleRequest();
            }
            return renderRequestsList();
        }

        function renderRequestsList() {
            const sortedRequests = [...requests].sort((a, b) => b.id - a.id);
            const pendingCount = requests.filter(r => r.status === 'pending').length;
            const answeredCount = requests.filter(r => r.status === 'answered').length;
            
            return `
                <div class="min-h-screen p-4 bg-gray-50">
                    <div class="max-w-7xl mx-auto">
                        <!-- Admin Header -->
                        <div class="bg-white rounded-2xl shadow-lg p-8 mb-6 fade-in">
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                    <h1 class="text-4xl font-bold text-blue-900 mb-2">×¤×× ×œ × ×™×”×•×œ</h1>
                                    <p class="text-gray-600 text-lg">×©×œ×•× ×¢×•×¤×¨ ×¦×•×¨×™××œ ğŸ‘‹</p>
                                    <p class="text-sm text-green-600 font-semibold mt-2 flex items-center gap-2">
                                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                        </svg>
                                        ××—×•×‘×¨ ×‘×”×¦×œ×—×”
                                    </p>
                                </div>
                                <div class="text-left space-y-2">
                                    <div class="bg-yellow-100 text-yellow-800 px-4 py-2 rounded-lg font-bold">
                                        â³ ×××ª×™× ×•×ª: ${pendingCount}
                                    </div>
                                    <div class="bg-green-100 text-green-800 px-4 py-2 rounded-lg font-bold">
                                        âœ“ × ×¢× ×•: ${answeredCount}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Requests List -->
                        <div class="bg-white rounded-2xl shadow-lg p-8 fade-in">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-3xl font-bold text-gray-800">×‘×§×©×•×ª ×œ×§×•×—×•×ª</h2>
                                <span class="bg-blue-100 text-blue-800 px-4 py-2 rounded-full font-bold">
                                    ×¡×”"×›: ${requests.length}
                                </span>
                            </div>
                            
                            ${requests.length === 0 ? `
                                <div class="text-center py-20 text-gray-400">
                                    <svg class="w-24 h-24 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/>
                                    </svg>
                                    <p class="text-2xl font-semibold mb-2">××™×Ÿ ×‘×§×©×•×ª ×›×¨×’×¢</p>
                                    <p class="text-lg">×‘×§×©×•×ª ×—×“×©×•×ª ×™×•×¤×™×¢×• ×›××Ÿ</p>
                                </div>
                            ` : `
                                <div class="space-y-4">
                                    ${sortedRequests.map((req, idx) => {
                                        const hasNewMessages = req.conversation && req.conversation.some(msg => msg.sender === 'customer' && !msg.read);
                                        return `
                                        <div
                                            onclick="viewRequest(${req.id})"
                                            class="border-2 border-gray-200 rounded-2xl p-6 hover:border-orange-500 hover:shadow-lg cursor-pointer transition-all transform hover:-translate-y-1 slide-in ${hasNewMessages ? 'bg-blue-50 border-blue-300' : ''}"
                                            style="animation-delay: ${idx * 0.05}s"
                                        >
                                            <div class="flex justify-between items-start">
                                                <div class="flex-1">
                                                    <div class="flex items-center gap-3 mb-2">
                                                        <h3 class="font-bold text-2xl text-gray-800">${req.name}</h3>
                                                        ${req.status === 'pending' ? `
                                                            <span class="bg-yellow-100 text-yellow-800 text-xs px-3 py-1 rounded-full font-bold animate-pulse">
                                                                ×—×“×©
                                                            </span>
                                                        ` : ''}
                                                        ${req.urgency && req.urgency !== '×¨×’×™×œ' ? `
                                                            <span class="bg-red-100 text-red-800 text-xs px-3 py-1 rounded-full font-bold">
                                                                ${req.urgency === '×“×—×•×£ ×××•×“' ? 'ğŸ”´ ×“×—×•×£ ×××•×“!' : 'âš¡ ×“×—×•×£'}
                                                            </span>
                                                        ` : ''}
                                                        ${hasNewMessages ? `
                                                            <span class="bg-blue-500 text-white text-xs px-3 py-1 rounded-full font-bold animate-pulse">
                                                                ğŸ’¬ ×”×•×“×¢×” ×—×“×©×”
                                                            </span>
                                                        ` : ''}
                                                    </div>
                                                    <div class="space-y-1 text-gray-600 mb-3">
                                                        <p class="flex items-center gap-2">
                                                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                                                <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
                                                            </svg>
                                                            ${req.phone}
                                                        </p>
                                                        <p class="flex items-center gap-2 font-semibold text-orange-600">
                                                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                                                <path d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3zM3.31 9.397L5 10.12v4.102a8.969 8.969 0 00-1.05-.174 1 1 0 01-.89-.89 11.115 11.115 0 01.25-3.762zM9.3 16.573A9.026 9.026 0 007 14.935v-3.957l1.818.78a3 3 0 002.364 0l5.508-2.361a11.026 11.026 0 01.25 3.762 1 1 0 01-.89.89 8.968 8.968 0 00-5.35 2.524 1 1 0 01-1.4 0zM6 18a1 1 0 001-1v-2.065a8.935 8.935 0 00-2-.712V17a1 1 0 001 1z"/>
                                                            </svg>
                                                            ${req.carPart}
                                                        </p>
                                                        <p class="text-sm">ğŸš— ${req.carManufacturer} ${req.carModel} ${req.year || ''}</p>
                                                    </div>
                                                    ${req.description ? `
                                                        <p class="text-sm text-gray-500 line-clamp-2 mb-2">${req.description}</p>
                                                    ` : ''}
                                                    <p class="text-xs text-gray-400 flex items-center gap-1">
                                                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                                                        </svg>
                                                        ${new Date(req.createdAt).toLocaleString('he-IL')}
                                                    </p>
                                                </div>
                                                <div class="mr-6 text-center">
                                                    <span class="inline-block px-4 py-2 rounded-xl text-sm font-bold shadow-md ${
                                                        req.status === 'answered' 
                                                            ? 'bg-green-500 text-white' 
                                                            : 'bg-yellow-400 text-gray-800'
                                                    }">
                                                        ${req.status === 'answered' ? 'âœ“ × ×¢× ×ª×”' : 'â³ ×××ª×™× ×”'}
                                                    </span>
                                                    ${req.images.length > 0 ? `
                                                        <p class="text-xs text-blue-600 mt-3 font-semibold flex items-center justify-center gap-1">
                                                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                                                <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"/>
                                                            </svg>
                                                            ${req.images.length} ×ª××•× ×•×ª
                                                        </p>
                                                    ` : ''}
                                                    ${req.conversation && req.conversation.length > 0 ? `
                                                        <p class="text-xs text-purple-600 mt-2 font-semibold">
                                                            ğŸ’¬ ${req.conversation.length} ×”×•×“×¢×•×ª
                                                        </p>
                                                    ` : ''}
                                                </div>
                                            </div>
                                        </div>
                                    `}).join('')}
                                </div>
                            `}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderSingleRequest() {
            const req = selectedRequest;
            const conversation = req.conversation || [];
            
            return `
                <div class="min-h-screen p-4 bg-gray-50">
                    <div class="max-w-6xl mx-auto">
                        <div class="bg-white rounded-2xl shadow-lg p-6 mb-6 fade-in">
                            <h1 class="text-3xl font-bold text-blue-900">×¤×× ×œ × ×™×”×•×œ - ×¢×•×¤×¨ ×¦×•×¨×™××œ</h1>
                        </div>

                        <div class="bg-white rounded-2xl shadow-lg p-8 fade-in">
                            <button
                                onclick="backToList()"
                                class="text-blue-600 hover:text-blue-800 mb-6 flex items-center gap-2 font-bold text-lg transition-all hover:gap-3"
                            >
                                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"/>
                                </svg>
                                ×—×–×¨×” ×œ×¨×©×™××”
                            </button>

                            <div class="border-b-2 border-gray-200 pb-6 mb-6">
                                <div class="flex justify-between items-start mb-4">
                                    <h2 class="text-4xl font-bold text-gray-800">${req.name}</h2>
                                    <span class="px-5 py-2 rounded-xl text-lg font-bold shadow-lg ${
                                        req.status === 'answered' 
                                            ? 'bg-green-500 text-white' 
                                            : 'bg-yellow-400 text-gray-800'
                                    }">
                                        ${req.status === 'answered' ? 'âœ“ × ×¢× ×ª×”' : 'â³ ×××ª×™× ×”'}
                                    </span>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 bg-gray-50 p-6 rounded-2xl">
                                    <div class="space-y-3">
                                        <p class="flex items-center gap-2 text-lg">
                                            <svg class="w-6 h-6 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
                                            </svg>
                                            <strong>×˜×œ×¤×•×Ÿ:</strong>
                                            <a href="tel:${req.phone}" class="text-blue-600 hover:underline">${req.phone}</a>
                                        </p>
                                        <p class="flex items-center gap-2 text-lg">
                                            <svg class="w-6 h-6 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
                                                <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
                                            </svg>
                                            <strong>××™××™×™×œ:</strong> ${req.email || '×œ× ×¦×•×™×Ÿ'}
                                        </p>
                                        ${req.urgency ? `
                                        <p class="flex items-center gap-2 text-lg">
                                            <svg class="w-6 h-6 ${req.urgency === '×“×—×•×£ ×××•×“' ? 'text-red-500' : req.urgency === '×“×—×•×£' ? 'text-orange-500' : 'text-gray-500'}" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                                            </svg>
                                            <strong>×“×—×™×¤×•×ª:</strong> 
                                            <span class="font-bold ${req.urgency === '×“×—×•×£ ×××•×“' ? 'text-red-600' : req.urgency === '×“×—×•×£' ? 'text-orange-600' : 'text-gray-600'}">${req.urgency}</span>
                                        </p>
                                        ` : ''}
                                    </div>
                                    <div class="space-y-3">
                                        <p class="flex items-center gap-2 text-lg">
                                            <svg class="w-6 h-6 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3z"/>
                                            </svg>
                                            <strong>×—×œ×§:</strong> ${req.carPart}
                                        </p>
                                        <p class="flex items-center gap-2 text-lg">
                                            <svg class="w-6 h-6 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"/>
                                                <path d="M3 4a1 1 0 00-1 1v10a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H10a1 1 0 001-1V5a1 1 0 00-1-1H3zM14 7a1 1 0 00-1 1v6.05A2.5 2.5 0 0115.95 16H17a1 1 0 001-1v-5a1 1 0 00-.293-.707l-2-2A1 1 0 0015 7h-1z"/>
                                            </svg>
                                            <strong>×¨×›×‘:</strong> ${req.carManufacturer} ${req.carModel} ${req.year || ''}
                                        </p>
                                    </div>
                                    <p class="text-gray-500 col-span-full flex items-center gap-2">
                                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                                        </svg>
                                        <strong>× ×©×œ×—×”:</strong> ${new Date(req.createdAt).toLocaleString('he-IL')}
                                    </p>
                                </div>
                            </div>

                            ${req.description ? `
                            <div class="mb-6">
                                <h3 class="font-bold text-2xl mb-3 flex items-center gap-2">
                                    <svg class="w-7 h-7 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                                    </svg>
                                    ×¤×¨×˜×™× × ×•×¡×¤×™×
                                </h3>
                                <div class="bg-blue-50 p-6 rounded-2xl text-lg leading-relaxed">
                                    ${req.description}
                                </div>
                            </div>
                            ` : ''}

                            ${req.images.length > 0 ? `
                                <div class="mb-6">
                                    <h3 class="font-bold text-2xl mb-4 flex items-center gap-2">
                                        <svg class="w-7 h-7 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"/>
                                        </svg>
                                        ×ª××•× ×•×ª (${req.images.length})
                                    </h3>
                                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                                        ${req.images.map((img, idx) => `
                                            <div class="image-preview-item rounded-2xl overflow-hidden shadow-lg">
                                                <img
                                                    src="${img.url}"
                                                    alt="${img.name}"
                                                    class="w-full h-56 object-cover cursor-pointer hover:opacity-90 transition"
                                                    onclick="window.open('${img.url}', '_blank')"
                                                />
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}

                            <!-- Conversation Section -->
                            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-300 rounded-2xl p-6 mb-6">
                                <h3 class="font-bold text-2xl mb-4 flex items-center gap-2">
                                    <svg class="w-7 h-7 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"/>
                                    </svg>
                                    ×©×™×—×” ×¢× ×”×œ×§×•×—
                                </h3>
                                
                                ${req.response || conversation.length > 0 ? `
                                    <div class="chat-container bg-white rounded-xl p-4 mb-4 space-y-4 shadow-inner">
                                        ${req.response ? `
                                            <div class="flex justify-end">
                                                <div class="chat-bubble chat-bubble-ofer rounded-2xl p-4 shadow">
                                                    <p class="text-sm font-semibold mb-1 opacity-90">××ª×” (×ª×©×•×‘×” ×¨××©×•× ×™×ª)</p>
                                                    <p class="leading-relaxed">${req.response}</p>
                                                    <p class="text-xs mt-2 opacity-75">${new Date(req.answeredAt).toLocaleString('he-IL', { hour: '2-digit', minute: '2-digit', day: '2-digit', month: '2-digit' })}</p>
                                                </div>
                                            </div>
                                        ` : ''}
                                        
                                        ${conversation.map(msg => `
                                            <div class="flex ${msg.sender === 'ofer' ? 'justify-end' : 'justify-start'}">
                                                <div class="chat-bubble ${msg.sender === 'ofer' ? 'chat-bubble-ofer' : 'chat-bubble-customer'} rounded-2xl p-4 shadow">
                                                    <p class="text-sm font-semibold mb-1 ${msg.sender === 'ofer' ? 'opacity-90' : 'text-gray-600'}">${msg.sender === 'ofer' ? '××ª×”' : req.name}</p>
                                                    <p class="leading-relaxed">${msg.message}</p>
                                                    <p class="text-xs mt-2 ${msg.sender === 'ofer' ? 'opacity-75' : 'text-gray-500'}">${new Date(msg.timestamp).toLocaleString('he-IL', { hour: '2-digit', minute: '2-digit', day: '2-digit', month: '2-digit' })}</p>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                ` : ''}
                                
                                <div class="bg-white rounded-xl p-4 shadow">
                                    <label class="block text-right font-bold mb-2">
                                        ${req.response ? '×”××©×š ×©×™×—×”:' : '×©×œ×— ×ª×©×•×‘×” ×¨××©×•× ×”:'}
                                    </label>
                                    <textarea
                                        id="responseText"
                                        class="w-full p-4 border-2 border-gray-300 rounded-xl mb-3 focus:border-blue-500 focus:outline-none text-lg resize-none"
                                        rows="4"
                                        placeholder="×›×ª×•×‘ ×›××Ÿ ××ª ×”×ª×©×•×‘×” ×œ×œ×§×•×—..."
                                    >${responseText}</textarea>
                                    <button
                                        onclick="sendResponse()"
                                        class="bg-blue-600 text-white px-8 py-3 rounded-xl hover:bg-blue-700 transition-all shadow-lg hover:shadow-xl flex items-center gap-3 font-bold text-lg"
                                    >
                                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"/>
                                        </svg>
                                        ×©×œ×— ×”×•×“×¢×”
                                    </button>
                                </div>
                            </div>

                            <button
                                onclick="deleteRequest()"
                                class="mt-6 bg-red-500 text-white px-6 py-3 rounded-2xl hover:bg-red-600 transition-all shadow-lg flex items-center gap-2 font-bold"
                            >
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"/>
                                </svg>
                                ××—×§ ×‘×§×©×”
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Event handlers
        function attachEventListeners() {
            if (currentView === 'customer') {
                const form = document.getElementById('customerForm');
                if (form) {
                    form.addEventListener('submit', handleSubmit);
                }

                const imageUpload = document.getElementById('imageUpload');
                if (imageUpload) {
                    imageUpload.addEventListener('change', handleImageUpload);
                }

                // Update form data on input
                ['carPart', 'carManufacturer', 'carModel', 'year', 'description', 'name', 'phone', 'email', 'urgency'].forEach(field => {
                    const input = document.getElementById(field);
                    if (input) {
                        input.addEventListener('input', (e) => {
                            formData[field] = e.target.value;
                            calculateProgress();
                        });
                        input.addEventListener('change', (e) => {
                            formData[field] = e.target.value;
                        });
                    }
                });

                // Status check phone input
                const statusPhoneInput = document.getElementById('statusPhone');
                if (statusPhoneInput) {
                    statusPhoneInput.addEventListener('input', (e) => {
                        statusPhone = e.target.value;
                    });
                    statusPhoneInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            checkStatus();
                        }
                    });
                }

                // Customer reply input
                const customerReplyInput = document.getElementById('customerReply');
                if (customerReplyInput) {
                    customerReplyInput.addEventListener('input', (e) => {
                        customerReplyText = e.target.value;
                    });
                }
            }

            if (currentView === 'admin' && selectedRequest) {
                const responseInput = document.getElementById('responseText');
                if (responseInput) {
                    responseInput.addEventListener('input', (e) => {
                        responseText = e.target.value;
                    });
                }
            }
        }

        function handleImageUpload(e) {
            const files = Array.from(e.target.files);
            if (images.length + files.length > 5) {
                alert('× ×™×ª×Ÿ ×œ×”×¢×œ×•×ª ×¢×“ 5 ×ª××•× ×•×ª ×‘×œ×‘×“');
                return;
            }

            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = (event) => {
                    images.push({ url: event.target.result, name: file.name });
                    render();
                };
                reader.readAsDataURL(file);
            });
        }

        function removeImage(index) {
            images.splice(index, 1);
            render();
        }

        function handleSubmit(e) {
            e.preventDefault();
            
            if (!formData.carPart || !formData.carManufacturer || !formData.carModel || !formData.name || !formData.phone) {
                alert('× × ×œ××œ× ××ª ×›×œ ×”×©×“×•×ª ×”××¡×•×× ×™× ×‘×›×•×›×‘×™×ª (*)');
                return;
            }

            isSubmitting = true;
            render();

            setTimeout(() => {
                const newRequest = {
                    id: Date.now(),
                    ...formData,
                    images: [...images],
                    createdAt: new Date().toISOString(),
                    status: 'pending',
                    response: null,
                    conversation: []
                };

                requests.push(newRequest);
                localStorage.setItem('serviceRequests', JSON.stringify(requests));

                // Reset form
                formData = { 
                    carPart: '', 
                    carManufacturer: '', 
                    carModel: '', 
                    year: '', 
                    description: '', 
                    name: '', 
                    phone: '', 
                    email: '',
                    urgency: '×¨×’×™×œ'
                };
                images = [];
                showSuccess = true;
                isSubmitting = false;
                formProgress = 0;
                render();

                // Hide success message after 7 seconds
                setTimeout(() => {
                    showSuccess = false;
                    render();
                }, 7000);

                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }, 1500);
        }

        function toggleStatusCheck() {
            showStatusCheck = !showStatusCheck;
            if (!showStatusCheck) {
                statusPhone = '';
                statusResult = null;
            }
            render();
        }

        function closeStatusCheck() {
            showStatusCheck = false;
            statusPhone = '';
            statusResult = null;
            render();
        }

        function checkStatus() {
            const phoneInput = document.getElementById('statusPhone');
            const phone = phoneInput ? phoneInput.value : statusPhone;
            
            if (!phone.trim()) {
                alert('× × ×œ×”×–×™×Ÿ ××¡×¤×¨ ×˜×œ×¤×•×Ÿ');
                return;
            }

            // Normalize phone number for comparison
            const normalizedSearch = phone.replace(/[\s\-]/g, '');
            
            // Find all requests by phone number and get the most recent one
            const found = requests
                .filter(req => {
                    const normalizedReq = req.phone.replace(/[\s\-]/g, '');
                    return normalizedReq.includes(normalizedSearch) || normalizedSearch.includes(normalizedReq);
                })
                .sort((a, b) => b.id - a.id)[0]; // Get the most recent (highest ID)

            if (found) {
                statusResult = found;
            } else {
                statusResult = 'not_found';
            }
            
            statusPhone = phone;
            render();
        }

        function sendCustomerReply() {
            const replyInput = document.getElementById('customerReply');
            const reply = replyInput ? replyInput.value : customerReplyText;
            
            if (!reply.trim()) {
                alert('× × ×œ×›×ª×•×‘ ×”×•×“×¢×”');
                return;
            }

            // Add message to conversation
            statusResult.conversation = statusResult.conversation || [];
            statusResult.conversation.push({
                sender: 'customer',
                message: reply,
                timestamp: new Date().toISOString(),
                read: false
            });

            // Update in requests array
            requests = requests.map(req => 
                req.id === statusResult.id ? statusResult : req
            );

            localStorage.setItem('serviceRequests', JSON.stringify(requests));
            customerReplyText = '';
            alert('×”×”×•×“×¢×” × ×©×œ×—×”! ğŸ’¬');
            render();
        }

        function viewRequest(id) {
            selectedRequest = requests.find(r => r.id === id);
            
            // Mark customer messages as read
            if (selectedRequest.conversation) {
                selectedRequest.conversation = selectedRequest.conversation.map(msg => ({
                    ...msg,
                    read: true
                }));
                requests = requests.map(req => 
                    req.id === selectedRequest.id ? selectedRequest : req
                );
                localStorage.setItem('serviceRequests', JSON.stringify(requests));
            }
            
            responseText = '';
            render();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function backToList() {
            selectedRequest = null;
            responseText = '';
            requests = JSON.parse(localStorage.getItem('serviceRequests') || '[]');
            render();
        }

        function sendResponse() {
            const textarea = document.getElementById('responseText');
            const response = textarea ? textarea.value : responseText;
            
            if (!response.trim()) {
                alert('× × ×œ×›×ª×•×‘ ×ª×©×•×‘×”');
                return;
            }

            if (!selectedRequest.response) {
                // First response
                requests = requests.map(req => 
                    req.id === selectedRequest.id 
                        ? { ...req, response: response, status: 'answered', answeredAt: new Date().toISOString() }
                        : req
                );
            } else {
                // Additional message in conversation
                selectedRequest.conversation = selectedRequest.conversation || [];
                selectedRequest.conversation.push({
                    sender: 'ofer',
                    message: response,
                    timestamp: new Date().toISOString()
                });
                
                requests = requests.map(req => 
                    req.id === selectedRequest.id ? selectedRequest : req
                );
            }

            localStorage.setItem('serviceRequests', JSON.stringify(requests));
            selectedRequest = requests.find(r => r.id === selectedRequest.id);
            responseText = '';
            alert('×”×”×•×“×¢×” × ×©×œ×—×” ×‘×”×¦×œ×—×”! ğŸ‰');
            render();
        }

        function deleteRequest() {
            if (confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ×‘×§×©×” ×–×•? ×¤×¢×•×œ×” ×–×• ×œ× × ×™×ª× ×ª ×œ×‘×™×˜×•×œ.')) {
                requests = requests.filter(req => req.id !== selectedRequest.id);
                localStorage.setItem('serviceRequests', JSON.stringify(requests));
                selectedRequest = null;
                render();
            }
        }

        // Make functions global
        window.removeImage = removeImage;
        window.viewRequest = viewRequest;
        window.backToList = backToList;
        window.sendResponse = sendResponse;
        window.deleteRequest = deleteRequest;
        window.toggleStatusCheck = toggleStatusCheck;
        window.closeStatusCheck = closeStatusCheck;
        window.checkStatus = checkStatus;
        window.sendCustomerReply = sendCustomerReply;

        // Initial render
        render();
    </script>
</body>
</html>
